---
ms.openlocfilehash: ca1f677bd38876befee833fcedd10388a71aecf4
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053111"
---
<a name="agent-base"></a>agent-base
==========
### <a name="turn-a-function-into-an-httpagenthttpagent-instance"></a>Превратите функцию в экземпляр [`http.Agent`][http.Agent]
[![Статус сборки](https://github.com/TooTallNate/node-agent-base/workflows/Node%20CI/badge.svg)](https://github.com/TooTallNate/node-agent-base/actions?workflow=Node+CI)

Этот модуль предоставляет генератор `http.Agent`. То есть вы передаете ему асинхронную функцию обратного вызова, и он возвращает новый экземпляр `http.Agent`, который вызовет данную функцию обратного вызова при отправке исходящих HTTP-запросов.

#### <a name="some-subclasses"></a>Некоторые подклассы:

Вот несколько более интересных вариантов применения `agent-base`.
Отправьте запрос на вытягивание, чтобы включить в список ваши варианты!

 * [`http-proxy-agent`][http-proxy-agent]: Реализация `http.Agent` прокси-сервера HTTP(s) для конечных точек HTTP
 * [`https-proxy-agent`][https-proxy-agent]: Реализация `http.Agent` прокси-сервера HTTP(s) для конечных точек HTTPS
 * [`pac-proxy-agent`][pac-proxy-agent]: Реализация `http.Agent` прокси-сервера файла PAC для HTTP и HTTPS
 * [`socks-proxy-agent`][socks-proxy-agent]: Реализация `http.Agent` прокси-сервера SOCKS для HTTP и HTTPS


<a name="installation"></a>Установка
------------

Установить с `npm`:

``` bash
$ npm install agent-base
```


<a name="example"></a>Пример
-------

Ниже приведен минимальный пример, который создает новое подключение `net.Socket` к серверу для каждого HTTP-запроса (т. е. эквивалент параметра `agent: false`):

```js
var net = require('net');
var tls = require('tls');
var url = require('url');
var http = require('http');
var agent = require('agent-base');

var endpoint = 'http://nodejs.org/api/';
var parsed = url.parse(endpoint);

// This is the important part!
parsed.agent = agent(function (req, opts) {
  var socket;
  // `secureEndpoint` is true when using the https module
  if (opts.secureEndpoint) {
    socket = tls.connect(opts);
  } else {
    socket = net.connect(opts);
  }
  return socket;
});

// Everything else works just like normal...
http.get(parsed, function (res) {
  console.log('"response" event!', res.headers);
  res.pipe(process.stdout);
});
```

Кроме того, поддерживается возврат обещания или использование функции `async`:

```js
agent(async function (req, opts) {
  await sleep(1000);
  // etc…
});
```

Верните другой экземпляр `http.Agent`, чтобы "передать" ответственность за этот HTTP-запрос данному агенту:

```js
agent(function (req, opts) {
  return opts.secureEndpoint ? https.globalAgent : http.globalAgent;
});
```


<a name="api"></a>API
---

## <a name="agentfunction-callback-object-options--httpagent"></a>Agent(Function callback[, Object options]) → [http.Agent][]

Создает базовый экземпляр `http.Agent`, который будет выполнять функцию обратного вызова `callback` для каждого HTTP-запроса, который используется в качестве `agent`. Функция обратного вызова отвечает за создание экземпляра `stream.Duplex` некоторого типа, который будет использоваться в качестве базового сокета в HTTP-запросе.

Объект `options` принимает следующие свойства:

  * `timeout` — число — время ожидания для функции `callback()` в миллисекундах. По умолчанию — бесконечность (необязательно).

Функция обратного вызова должна иметь следующую сигнатуру:

### <a name="callbackhttpclientrequest-req-object-options-function-cb--undefined"></a>callback(http.ClientRequest req, Object options, Function cb) → undefined

К `req` ClientRequest можно обратиться для считывания заголовков запросов, пути и т. д. Объект `options` содержит параметры, передаваемые вызову функции `http.request()`/`https.request()`, и форматируется для непосредственной передачи `net.connect()`/`tls.connect()` создания сокета любым другим способом. Передайте созданный сокет в функцию обратного вызова `cb` после создания, и HTTP-запрос продолжит выполняться.

Если модуль `https` используется для вызова HTTP-запроса, то для свойства `secureEndpoint` в `options`  _будет задано значение `true`_ .


<a name="license"></a>Лицензия
-------

(Лицензия MIT)

(c) 2013 г., Натан Раджлич (Nathan Rajlich) &lt;nathan@tootallnate.net&gt;

Настоящим любому лицу, получившему копию этого программного обеспечения и связанных с ним файлов документации ("Программное обеспечение"), бесплатно предоставляется разрешение на любые действия с Программным обеспечением, включая, без ограничений, право на использование, копирование, изменение, слияние, публикацию, распространение, сублицензирование и (или) продажу копий Программного обеспечения, а также разрешение делать это лицам, которым предоставлено Программное обеспечение для этого, на следующих условиях:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

[http-proxy-agent]: https://github.com/TooTallNate/node-http-proxy-agent
[https-proxy-agent]: https://github.com/TooTallNate/node-https-proxy-agent
[pac-proxy-agent]: https://github.com/TooTallNate/node-pac-proxy-agent
[socks-proxy-agent]: https://github.com/TooTallNate/node-socks-proxy-agent
[http.Agent]: https://nodejs.org/api/http.html#http_class_http_agent
