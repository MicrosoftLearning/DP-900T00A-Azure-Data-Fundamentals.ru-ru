
---
<p align="center">
  <strong>
    <a href="https://open-telemetry.github.io/opentelemetry-js-api">Документация API<a/> &nbsp;&nbsp;&bull;&nbsp;&nbsp; <a href="https://github.com/open-telemetry/opentelemetry-js/discussions">Войти в контакт (обсуждения GitHub)<a/>
  </strong>
</p>

<p align="center">
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/releases">
    <img alt="GitHub release (latest by date including pre-releases)" src="https://img.shields.io/github/v/release/open-telemetry/opentelemetry-js-api?include_prereleases&style=for-the-badge">
  </a>
  <a href="https://codecov.io/gh/open-telemetry/opentelemetry-js-api/branch/main/">
    <img alt="Codecov Status" src="https://img.shields.io/codecov/c/github/open-telemetry/opentelemetry-js-api?style=for-the-badge">
  </a>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/blob/main/LICENSE">
    <img alt="license" src="https://img.shields.io/badge/license-Apache_2.0-green.svg?style=for-the-badge">
  </a>
  <br/>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/docs.yaml">
    <img alt="Build Status" src="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/test.yaml/badge.svg?branch=main">
  </a>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/test.yaml?query=branch%3Amain">
    <img alt="Build Status" src="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/docs.yaml/badge.svg">
  </a>
</p>

---

# <a name="opentelemetry-api-for-javascript"></a>OpenTelemetry API для JavaScript

[![Опубликованная версия NPM][npm-img]][npm-url]
[![зависимости][dependencies-image]][dependencies-url]
[![devDependencies][devDependencies-image]][devDependencies-url]

Этот пакет предоставляет все необходимое для взаимодействия с API OpenTelemetry, включая все интерфейсы TypeScript, перечисления и реализации без операций. Он предназначен для использования как на сервере, так и в браузере.

Методы в этом пакете по умолчанию не выполняют никаких операций. Это означает, что их можно безопасно вызвать библиотекой или приложением конечного пользователя независимо от того, зарегистрирован пакет SDK или нет. Для создания и экспорта данных телеметрии также потребуется пакет SDK, например [OpenTelemetry JS SDK][opentelemetry-js].

## <a name="tracing-quick-start"></a>Краткое руководство по трассировке

### <a name="you-will-need"></a>Потребуется следующее:

- Приложение, которое вы хотите инструментировать
- [OpenTelemetry JS SDK][opentelemetry-js]
- Node.js >=8.5.0 (предпочтительнее 14+) или браузер, совместимый с ECMAScript 5+

**Примечание**. Совместимость ECMAScript 5+ поддерживается только для этого пакета. Чтобы определить минимальную версию ECMAScript, см. документацию по используемому пакету SDK.

**Примечание для авторов библиотеки:** Паркет OpenTelemetry SDK понадобится только вашим конечным пользователям. Если вы хотите поддерживать OpenTelemetry в своей библиотеке, необходимо использовать только API OpenTelemetry. Дополнительные сведения см. в [документации по трассировке][docs-tracing].

### <a name="install-dependencies"></a>Установка зависимостей

```sh
npm install @opentelemetry/api @opentelemetry/tracing
```

### <a name="trace-your-application"></a>Трассировка своего приложения

Чтобы приступить к работе с трассировкой, необходимо сначала зарегистрировать пакет SDK. Используемый пакет SDK может предоставить удобный метод, который вызывает методы регистрации, но если требуется вызвать их напрямую, они описаны в статье [Методы регистрации пакета SDK][docs-sdk-registration].

После регистрации пакета SDK можно запускать и завершать диапазоны. Ниже приведен простой пример типовой регистрации пакета SDK и трассировки простой операции. Пример должен экспортировать диапазоны в консоль один раз в секунду. Дополнительные сведения см. в [Документация по трассировке][docs-tracing].

```javascript
const { trace }  = require("@opentelemetry/api");
const { BasicTracerProvider, ConsoleSpanExporter, SimpleSpanProcessor }  = require("@opentelemetry/tracing");

// Create and register an SDK
const provider = new BasicTracerProvider();
provider.addSpanProcessor(new SimpleSpanProcessor(new ConsoleSpanExporter()));
trace.setGlobalTracerProvider(provider);

// Acquire a tracer from the global tracer provider which will be used to trace the application
const name = 'my-application-name';
const version = '0.1.0';
const tracer = trace.getTracer(name, version);

// Trace your application by creating spans
async function operation() {
  const span = tracer.startSpan("do operation");

  // mock some work by sleeping 1 second
  await new Promise((resolve, reject) => {
    setTimeout(resolve, 1000);
  })

  span.end();
}

async function main() {
  while (true) {
    await operation();
  }
}

main();
```

## <a name="version-compatibility"></a>Совместимость версий

Так как алгоритм разрешения модуля npm и установщик npm могут позволить двум или более копиям любого заданного пакета существовать в одной структуре `node_modules`, в интерфейсе API OpenTelemetry используется переменная в объекте `global` для хранения глобального API. Когда вызывается метод API в пакете API, он проверяет, существует ли этот API `global`, а прокси-серверы вызывают его, только если это совместимая версия API. Это означает, что если пакет зависит от версии API OpenTelemetry, несовместимой с API, используемой конечным пользователем, пакет получит реализацию API без операций.

## <a name="upgrade-guidelines"></a>Рекомендации по обновлению

### <a name="0210-to-100"></a>с 0.21.0 до 1.0.0

Критических изменений нет.

### <a name="0200-to-0210"></a>с 0.20.0 до 0.21.0

- [#78](https://github.com/open-telemetry/opentelemetry-js-api/issues/78) Аргументы `api.context.bind` теперь перечислены в обратном порядке, и `context` теперь является обязательным аргументом.
- [№ 46](https://github.com/open-telemetry/opentelemetry-js-api/issues/46) Классы Noop и синглетоны больше не экспортируются. Чтобы создать диапазон noop, рекомендуется использовать `api.trace.wrapSpanContext` с `INVALID_SPAN_CONTEXT` вместо `NOOP_TRACER`.

### <a name="100-rc3-to-0200"></a>с 1.0.0-rc.3 до 0.20.0

- Удаление `TimedEvent`, которое не было частью спецификации
- `HttpBaggage` переименован в `HttpBaggagePropagator`
- [#45](https://github.com/open-telemetry/opentelemetry-js-api/pull/45) `Span#context` переименован в `Span#spanContext`
- [№ 47](https://github.com/open-telemetry/opentelemetry-js-api/pull/47)`getSpan`/`setSpan`/`getSpanContext`/`setSpanContext` перемещены в пространство имен `trace`
- [#55](https://github.com/open-telemetry/opentelemetry-js-api/pull/55) `getBaggage`/`setBaggage`/`createBaggage` перемещены в пространство имен `propagation`

## <a name="useful-links"></a>Полезные ссылки

- Дополнительные сведения о OpenTelemetry см. в статье: <https://opentelemetry.io/>
- Дополнительные сведения о OpenTelemetry JavaScript см. в статье: <https://github.com/open-telemetry/opentelemetry-js>
- Для получения справки или отзывов по этому проекту присоединяйтесь к нам в [обсуждениях на GitHub][discussions-url]

## <a name="license"></a>Лицензия

Apache 2.0 — дополнительные сведения см. в разделе [ЛИЦЕНЗИЯ][license-url].

[opentelemetry-js]: https://github.com/open-telemetry/opentelemetry-js

[discussions-url]: https://github.com/open-telemetry/opentelemetry-js/discussions
[license-url]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/LICENSE
[license-image]: https://img.shields.io/badge/license-Apache_2.0-green.svg?style=flat
[dependencies-image]: https://status.david-dm.org/gh/open-telemetry/opentelemetry-js-api.svg
[dependencies-url]: https://david-dm.org/open-telemetry/opentelemetry-js-api
[devDependencies-image]: https://status.david-dm.org/gh/open-telemetry/opentelemetry-js-api.svg?type=dev
[devDependencies-url]: https://david-dm.org/open-telemetry/opentelemetry-js-api?type=dev
[npm-url]: https://www.npmjs.com/package/@opentelemetry/api
[npm-img]: https://badge.fury.io/js/%40opentelemetry%2Fapi.svg
[docs-tracing]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/docs/tracing.md
[docs-sdk-registration]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/docs/sdk-registration.md
