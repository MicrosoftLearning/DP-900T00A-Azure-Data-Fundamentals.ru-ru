---
ms.openlocfilehash: 81fd1455668c9343defe69cbbbff10d48b1f97ef
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052868"
---
<a name="gauge"></a>индикаторная диаграмма
=====

Горизонтальный датчик / индикатор выполнения на основе терминала практически без отслеживания состояния.

```javascript
var Gauge = require("gauge")

var gauge = new Gauge()

gauge.show("test", 0.20)

gauge.pulse("this")

gauge.hide()
```

![](gauge-demo.gif)


### <a name="changes-from-1x"></a>ИЗМЕНЕНИЯ ПО СРАВНЕНИЮ С ВЕРСИЕЙ 1.x

Датчик 2.x представляет собой критический выпуск. Сведения о том, что изменилось, если вы ранее были пользователем этого модуля, см. в [журнале изменений].

[журнал изменений]: CHANGELOG.md

### <a name="the-gauge-class"></a>КЛАСС ДАТЧИКА

Это типичный интерфейс для модуля. Он предоставляет самонаводящийся интерфейс для отображения сведений о состоянии.

```
var Gauge = require("gauge")

var gauge = new Gauge([stream], [options])
```

* **stream** — *(необязательно, STDERR по умолчанию)* Поток для записи обновлений индикатора выполнения.  Датчик учитывает обратную реакцию и приостановит большую часть записи, если она указана.
* **options** — *(необязательно)* Объект option.

Создает новый датчик. Датчики рисуются в одной строке и не рисуются, если **поток** не является tty и tty не предоставляется явным образом.

Если **поток** представляет собой терминал или вы передаете **tty** в **options**, мы определим изменение размера терминала и перерисуем его соответствующим образом.  Для этого мы отслеживаем события `resize` на tty.  (Чтобы обойти ошибку, которая наблюдается в версиях Node.js до 2.5.0, мы отслеживаем их в stdout, если tty — stderr.) Размер окна будет изменен на более крупный чисто, однако сжатие окна всегда будет сопровождаться образованием некоторого несобираемого мусора.

**ВАЖНО**. Если вы ранее передавали поток, отличный от tty, однако вам по-прежнему требуются выходные данные (например, поток, заключенный в модуль `ansi`), необходимо передать параметр **tty** ниже, так как `gauge` требуется доступ к базовому tty для выполнения таких действий, как изменение размера терминала и определение ширины терминала.

Объект **options** может иметь следующие свойства, все из которых являются необязательными:

* **updateInterval**: частота рисования обновлений датчика в миллисекундах.
* **fixedFramerate**: по умолчанию имеет значение false на узле 0.8 и значение true на всех остальных узлах.  Если задано значение true, таймер создается для запуска каждые `updateInterval` мс; если задано значение false, обновления печатаются сразу после поступления, однако обновления чаще, чем `updateInterval`, игнорируются.  Причина, по которой на узле 0.8 для этого параметра не задано значение true, заключается в том, что он не может `unref` свой таймер — это препятствовало бы выходу из программы. Если вы хотите использовать эту функцию с 0.8, просто убедитесь в том, что вызываете `gauge.disable()` до того, как начинаете ждать завершения программы.
* **themes**: набор тем для использования при выборе темы. По умолчанию имеет значение `gauge/themes`. Дополнительные сведения см. в документации по [themes].
* **theme**: выберите тему для использования. Это может быть:
  * Объект theme. В этом случае **themes** не используется.
  * Имя темы, поиск которой будет выполняться в текущем объекте *темы*.
  * Объект конфигурации с любым из ключей `hasUnicode`, `hasColor` или `platform`, который будет использоваться для переопределения наших предположений при выборе темы по умолчанию.

  Если тема не выбрана, то для выбора значения по умолчанию используется сочетание наших наилучших предположений в вашей ОС, поддержке цветов и поддержке Юникода.
* **template**: описывает, как будет выглядеть датчик.  Значение по умолчанию — то, что использует npm.  Подробная [документация] будет представлена далее в этом документе.
* **hideCursor**: По умолчанию используется значение true.  Если задано значение true, курсор при отображении датчика будет скрыт.
* **tty**: служба tty, в которую в конечном итоге осуществляется запись.  По умолчанию используется то же значение, что и для **stream**.  Используется для определения ширины терминала и изменения размера. Используется ширина `tty.columns - 1`. Если служба tty недоступна, предполагается, что ширина равна `79`.
* **enabled**: по умолчанию имеет значение true, если `tty` — TTY, в противном случае — значение false.  Если задано значение true, датчик запускается включенным.  Если датчик отключен, все команды обновления игнорируются и датчик не будет напечатан, пока вы не вызовете `.enable()`.
* **Plumbing**: класс, используемый для фактического создания датчика для печати.  По умолчанию имеет значение `require('gauge/plumbing')`, которое обычно не требуется переопределять.
* **cleanupOnExit**: По умолчанию используется значение true. Обычно мы регистрируем обработчик выхода, чтобы гарантировать, что курсор снова включается, а индикатор выполнения стирается при выходе процесса, даже если вы выходите с помощью сочетания клавиш CTRL+C или иным образом выполняете непредвиденный выход. Это можно отключить, и обработчик выхода регистрироваться не будет.

[has-unicode]: https://www.npmjs.com/package/has-unicode
[themes]: #themes:
[документация]: #templates

#### `gauge.show(section | status, [completed])`

Первым аргументом является либо section, имя текущей вещи, способствующий прогрессу, либо object с такими ключами, как **section**, **subsection** и **completed** (или любыми другими, для которых имеются типы в пользовательском шаблоне).  Если вы не хотите обновлять или задавать что-либо из перечисленного, можно передать `null`, и они будут игнорироваться.

Второй аргумент — процент выполнения как значение от 0 до 1.
Без него выполнение просто не обновляется. Вы также заметите, что выполнение можно передавать как часть объекта состояния в качестве первого аргумента. Если переданы как выполнение, так и аргумент completed, побеждает аргумент completed.

#### `gauge.hide([cb])`

Удаляет датчик из терминала.  При необходимости можно было выполнить обратный вызов `cb` после ввода-вывода (в настоящее время это просто означает после того, как `setImmediate` выполняет обратный вызов).

Оказывается, это важно, когда вы приостанавливаете индикатор выполнения в одном дескрипторе файла и печатаете в другой, — в противном случае (при достаточно большом объеме печати) узел может в конечном итоге распечатать биты "окончания индикатора выполнения" в дескриптора файла индикатора выполнения, авсе остальное — в другой дескриптор файла. Такое чередование может привести к повреждению в некоторых терминалах.

#### `gauge.pulse([subsection])`

* **subsection** — *(необязательно)* Конкретная вещь, активировавшая этот импульс.

Вращает вертушку в датчике, чтобы отобразить выходные данные.  При включении **subsection** объединяется с фамилией, переданной в `gauge.show`.

#### `gauge.disable()`

Скрывает датчик и игнорирует дальнейшие вызовы `show` или `pulse`.

#### `gauge.enable()`

Показывает датчик и возобновляет обновление при вызове `show` или `pulse`.

#### `gauge.isEnabled()`

Возвращает значение true, если датчик включен.

#### `gauge.setThemeset(themes)`

Измените набор тем для выбора темы. Тот же параметр, что и параметр `themes`, используемый в конструкторе. Тема будет повторно выбрана из этого набора тем.

#### `gauge.setTheme(theme)`

В случае изменения активная тема будет отображена при следующем отображении или импульсе. Это может быть:

* Объект theme. В этом случае **themes** не используется.
* Имя темы, поиск которой будет выполняться в текущем объекте *темы*.
* Объект конфигурации с любым из ключей `hasUnicode`, `hasColor` или `platform`, который будет использоваться для переопределения наших предположений при выборе темы по умолчанию.

Если тема не выбрана, то для выбора значения по умолчанию используется сочетание наших наилучших предположений в вашей ОС, поддержке цветов и поддержке Юникода.

#### `gauge.setTemplate(template)`

В случае изменения активный шаблон будет отображен при следующем отображении или импульсе.

### <a name="tracking-completion"></a>Отслеживание выполнения

Если у вас несколько процессов, выполнение которых требуется отслеживать, связанные [are-we-there-yet] могут оказаться полезны.  Событие `change` можно подключить к методу `show`, чтобы получить более традиционный интерфейс индикатора выполнения.

[are-we-there-yet]: https://www.npmjs.com/package/are-we-there-yet

### <a name="themes"></a>THEMES

```
var themes = require('gauge/themes')

// fetch the default color unicode theme for this platform
var ourTheme = themes({hasUnicode: true, hasColor: true})

// fetch the default non-color unicode theme for osx
var ourTheme = themes({hasUnicode: true, hasColor: false, platform: 'darwin'})

// create a new theme based on the color ascii theme for this platform
// that brackets the progress bar with arrows
var ourTheme = themes.newTheme(theme(hasUnicode: false, hasColor: true}), {
  preProgressbar: '→',
  postProgressbar: '←'
})
```

Объект, возвращаемый `gauge/themes`, является экземпляром класса `ThemeSet`.

```
var ThemeSet = require('gauge/theme-set')
var themes = new ThemeSet()
// or
var themes = require('gauge/themes')
var mythemes = themes.newThemeset() // creates a new themeset based on the default themes
```

#### <a name="themesopts"></a>themes(opts)
#### <a name="themesgetdefaultopts"></a>themes.getDefault(opts)

Объекты Theme — это функция, которая получает тему по умолчанию в зависимости от поддерживаемой платформы, Юникода и цветов.

Options — это объект со следующими свойствами:

* **hasUnicode** — если задано значение true, извлекает тему Юникода; если тема Юникода недоступна, будет использоваться тема, не относящаяся к Юникоду.
* **hasColor** — если задано значение true, получает цветовую тему; если цветовая тема недоступна, будет использоваться нецветовая тема.
* **platform** (необязательно) — по умолчанию `process.platform`.  Если совпадение с платформой недоступно, используется `fallback`.

Если не удается найти совместимую тему, возникает ошибка с `code` `EMISSINGTHEME`.

#### <a name="themesaddthemethemename-themeobj"></a>themes.addTheme(themeName, themeObj)
#### <a name="themesaddthemethemename-parenttheme-newtheme"></a>themes.addTheme(themeName, [parentTheme], newTheme)

Добавляет именованную тему в набор тем.  Можно передать объект theme, возвращаемый `themes.newTheme`, или аргументы, переданные в `themes.newTheme`.

#### <a name="themesgetthemenames"></a>themes.getThemeNames()

Возвращает список всех имен тем в этом наборе тем. Подходит для использования в `themes.getTheme(…)`.

#### <a name="themesgetthemename"></a>themes.getTheme(name)

Возвращает объект theme из этого набора тем с именем `name`.

Если `name` в этом наборе тем не существует, возникает ошибка с `code` `EMISSINGTHEME`.

#### <a name="themessetdefaultopts-themename"></a>themes.setDefault([opts], themeName)

`opts` — это объект со следующими свойствами:

* **platform** — по умолчанию `'fallback'`.  Если ваша тема предназначена для конкретной платформы, укажите, что это здесь с платформой из `process.platform`, например, `win32`, `darwin`и т. д.
* **hasUnicode** — по умолчанию —`false`. Если в вашей теме используется Юникод, необходимо задать значение true.
* **hasColor** — по умолчанию `false`.  Если в вашей теме используется цвет, необходимо задать значение true.

`themeName` — это имя темы (как указано в `addTheme`), которое используется для этого набора `opts`.

#### <a name="themesnewthemeparenttheme-newtheme"></a>themes.newTheme([parentTheme,] newTheme)

Создание объекта theme на основе `parentTheme`.  Если `parentTheme` отсутствует, будет определен минимальный элемент parentTheme, определяющий функции для отрисовки индикатора действия (вертушки) и индикатора выполнения. (Этот резервный родительский элемент определен в `gauge/base-theme`.)

Объект newTheme должен представлять собой простой объект. Для начала обсудим свойства, определенные темами по умолчанию:

* **preProgressbar** — отображается перед индикатором выполнения, если отображается индикатор выполнения.
* **preProgressbar** — отображается после индикатора выполнения, если отображается индикатор выполнения.
* **progressBarTheme** — подтема, передаваемая в отрисовщик индикатора выполнения; это объект со свойствами `complete` и `remaining`, представляющими собой строки, которые требуется повторить для этих разделов индикатора выполнения.
* **activityIndicatorTheme** — тема для индикатора действия (вертушки); это может быть строка, в которой каждый символ представляет собой отдельный шаг или массив строк.
* **preSubsection** — отображается в качестве разделителя между `section` и `subsection` при печати последнего.

В целом темы могут иметь любое значение, которое будет допустимым при отрисовке шаблонов. Свойства в теме используются, когда их имя соответствует типу в шаблоне. Они могут принимать следующие значения:

* **строки и числа** — они будут включены как есть;
* **function (values, theme, width)**  — должна возвращать нужные значения в выходных данных.
  *values* — это объект со значениями, предоставленными с помощью `gauge.show`; *theme* — это тема, связанная с этим элементом (см. ниже) или объект theme, а *width* — это количество символов, соответствующее требуемой ширине результата.

Существует несколько специальных префиксов:

* **pre** — отображается перед свойством, если оно отображается.
* **post** — отображается после свойства, если оно отображается.

И один специальный суффикс:

* **Theme** — его значение передается элементу типа функция в качестве темы.

#### <a name="themesaddtoallthemestheme"></a>themes.addToAllThemes(theme)

Эта функция *смешивает* `theme` со всеми темами, определенными на данный момент. Она также добавляет ее в родительскую тему по умолчанию для этого набора тем, поэтому будущие темы, добавленные в этот набор тем, будут получать значения от `theme` по умолчанию.

#### <a name="themesnewthemeset"></a>themes.newThemeset()

Копирует текущий набор тем в новый.  Это позволяет легко наследовать один набор тем от другого.

### <a name="templates"></a>ШАБЛОНЫ

Шаблон — это массив объектов и строк, которые после оценки будут преобразованы в строку датчика.  Шаблон по умолчанию:

```javascript
[
    {type: 'progressbar', length: 20},
    {type: 'activityIndicator', kerning: 1, length: 1},
    {type: 'section', kerning: 1, default: ''},
    {type: 'subsection', kerning: 1, default: ''}
]
```

Различные элементы шаблона могут представлять собой либо **обычные строки** (в этом случае они будут включены в выходные данные буквально), либо объекты со следующими свойствами:

* *type* может представлять собой что угодно из перечисленного, а также любые ключи, передаваемые в `gauge.show`, и любые ключи, имеющиеся в пользовательской теме.
  * `section` — проект, над которым вы работаете в данный момент.
  * `subsection` — компонент этого проекта, который на данный момент работает.
  * `activityIndicator` — показывает вертушку с помощью `activityIndicatorTheme` из активной темы.
  * `progressbar` — индикатор выполнения, представляющий текущий `completed` с помощью `progressbarTheme` из активной темы.
* *kerning* — количество пробелов, которые должны находиться между этим элементом и другими элементами, если этот элемент вообще отображается.
* *maxLength* — максимальная длина для этого элемента. Если его значение больше, оно будет усечено.
* *minLength* — минимальная длина для этого элемента. Если его значение короче, оно будет заполнено в соответствии со значением *выравнивания*.
* *align* — (по умолчанию: left) Возможные значения — "left", "right" и "center". Работает так, как должны работать текстовые процессоры.
* *length* — предоставляет одно значение для *minLength* и *maxLength*. Если указаны как *length*, так и *minLength или *maxLength*, то последнее имеет приоритет.
* *value* — литеральное значение, используемое для этого элемента шаблона.
* *default* — значение по умолчанию, используемое для этого элемента шаблона, если значение не было передано иным образом.

### <a name="plumbing"></a>СВЯЗУЮЩЕЕ ПО

Это очень простые внутренние элементы, которые ничего не предполагают и не делают ничего необычного, — датчик использует их для реализации своего обычного интерфейса.

```
var Plumbing = require('gauge/plumbing')
var gauge = new Plumbing(theme, template, width)
```

* **theme**: используемая тема.
* **template**: используемый шаблон.
* **width**: ширина датчика.

#### `gauge.setTheme(theme)`

Изменение активной темы.

#### `gauge.setTemplate(template)`

Изменение активного шаблона.

#### `gauge.setWidth(width)`

Изменение ширины для отрисовки.

#### `gauge.hide()`

Возврат строки, необходимой для скрытия индикатора выполнения.

#### `gauge.hideCursor()`

Возврат строки для скрытия курсора.

#### `gauge.showCursor()`

Возврат строки для отображения курсора.

#### `gauge.show(status)`

С помощью `status` для значений отрисуйте предоставленный шаблон с темой и верните строку, подходящую для печати, чтобы обновить датчик.
