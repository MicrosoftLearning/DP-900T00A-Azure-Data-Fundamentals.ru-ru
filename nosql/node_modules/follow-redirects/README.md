---
ms.openlocfilehash: aa7ddb2f2ce7709064cf5157f709fc1eff52cff7
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052596"
---
## <a name="follow-redirects"></a>Поддержка перенаправлений

Прямая замена для модулей `http` и `https` в node.js с автоматическим переходом по перенаправлениям.

[![Версия npm](https://img.shields.io/npm/v/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![Статус сборки](https://github.com/follow-redirects/follow-redirects/workflows/CI/badge.svg)](https://github.com/follow-redirects/follow-redirects/actions)
[![Статус покрытия](https://coveralls.io/repos/follow-redirects/follow-redirects/badge.svg?branch=master)](https://coveralls.io/r/follow-redirects/follow-redirects?branch=master)
[![Загрузки npm](https://img.shields.io/npm/dm/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![Спонсор на GitHub](https://img.shields.io/static/v1?label=Sponsor&message=%F0%9F%92%96&logo=GitHub)](https://github.com/sponsors/RubenVerborgh)

`follow-redirects` предоставляет методы [request](https://nodejs.org/api/http.html#http_http_request_options_callback) и [get](https://nodejs.org/api/http.html#http_http_get_options_callback), которые ведут себя аналогично методам в собственных модулях [HTTP](https://nodejs.org/api/http.html#http_http_request_options_callback) и [HTTPS](https://nodejs.org/api/https.html#https_https_request_options_callback), за исключением того, что они напрямую переходят по перенаправлениям.

```javascript
const { http, https } = require('follow-redirects');

http.get('http://bit.ly/900913', response => {
  response.on('data', chunk => {
    console.log(chunk);
  });
}).on('error', err => {
  console.error(err);
});
```

Узнать окончательный URL-адрес перенаправления можно с помощью свойства `responseUrl` в `response`.
Если перенаправления не было, `responseUrl` равен исходному URL-адресу запроса.

```javascript
const request = https.request({
  host: 'bitly.com',
  path: '/UHfDGO',
}, response => {
  console.log(response.responseUrl);
  // 'http://duckduckgo.com/robots.txt'
});
request.end();
```

## <a name="options"></a>Параметры
### <a name="global-options"></a>Глобальные параметры
Глобальные параметры задаются непосредственно в модуле `follow-redirects`:

```javascript
const followRedirects = require('follow-redirects');
followRedirects.maxRedirects = 10;
followRedirects.maxBodyLength = 20 * 1024 * 1024; // 20 MB
```

Поддерживаются следующие глобальные параметры:

- `maxRedirects` (по умолчанию: `21`) — задает максимальное число разрешенных перенаправлений. При его превышении выдается ошибка.

- `maxBodyLength` (по умолчанию: 10 МБ) — задает максимальный размер текста запроса. При превышении выдается ошибка.

### <a name="per-request-options"></a>Параметры на уровне запроса
Параметры на уровне запроса задаются путем передачи объекта `options`:

```javascript
const url = require('url');
const { http, https } = require('follow-redirects');

const options = url.parse('http://bit.ly/900913');
options.maxRedirects = 10;
options.beforeRedirect = (options, { headers }) => {
  // Use this to adjust the request options upon redirecting,
  // to inspect the latest response headers,
  // or to cancel the request by throwing an error
  if (options.hostname === "example.com") {
    options.auth = "user:password";
  }
};
http.request(options);
```

Помимо [стандартных параметров HTTP](https://nodejs.org/api/http.html#http_http_request_options_callback) и [HTTPS](https://nodejs.org/api/https.html#https_https_request_options_callback) поддерживаются следующие параметры на уровне запроса:
- `followRedirects` (по умолчанию: `true`) — следовать ли по перенаправлениям.

- `maxRedirects` (по умолчанию: `21`) — задает максимальное число разрешенных перенаправлений. При его превышении выдается ошибка.

- `maxBodyLength` (по умолчанию: 10 МБ) — задает максимальный размер текста запроса. При превышении выдается ошибка.

- `beforeRedirect` (по умолчанию: `undefined`) — при необходимости изменить `options` для запроса в перенаправлениях или прервать запрос, создав ошибку.

- `agents` (по умолчанию: `undefined`) — задает параметр `agent` для каждого протокола, так как в HTTP и HTTPS используются разные агенты. Пример значения: `{ http: new http.Agent(), https: new https.Agent() }`

- `trackRedirects` (по умолчанию: `false`) — следует ли хранить сведения о перенаправленных ответах в массиве `redirects` в объекте ответа.


### <a name="advanced-usage"></a>Расширенное использование
По умолчанию в `follow-redirects` используются реализации модулей [`http`](https://nodejs.org/api/http.html) и [`https`](https://nodejs.org/api/https.html), принятые в Node.js по умолчанию.
Чтобы включить такие функции, как кэширование или промежуточное отслеживание запросов, можно использовать `follow-redirects` в качестве оболочки для пользовательской реализации протоколов:

```javascript
const { http, https } = require('follow-redirects').wrap({
  http: require('your-custom-http'),
  https: require('your-custom-https'),
});
```

Для таких пользовательских протоколов требуется только реализация метода `request`.

## <a name="browser-usage"></a>Использование браузера

Из-за особенностей работы браузера браузерные эквиваленты `http` и `https` по умолчанию выполняют перенаправления.

Задав в `follow-redirects` следующие директивы require:
```javascript
const http = require('follow-redirects/http');
const https = require('follow-redirects/https');
```
можно сделать так, чтобы в webpack и аналогичных инструментах вместо `follow-redirect` использовались встроенные версии:

```json
{
  "follow-redirects/http"  : "http",
  "follow-redirects/https" : "https"
}
```

## <a name="contributing"></a>Участие

Запросы на внесение изменений всегда приветствуются. [Зарегистрируйте проблему](https://github.com/follow-redirects/follow-redirects/issues), описав свое предложение, прежде чем тратить свое время. Дополнительные функции и исправления ошибок должны тестироваться. Набор тестов можно запустить локально с помощью простой команды `npm test`.

## <a name="debug-logging"></a>Ведение журнала отладки

В `follow-redirects` используется [утилита отладки](https://www.npmjs.com/package/debug), которая позволяет вести журнал. Для ведения журнала задайте переменную среды `DEBUG=follow-redirects`, чтобы отслеживать выходные данные отладки только из этого модуля. При выполнении набора тестов иногда удобно задать `DEBUG=*`, чтобы также видеть выходные данные с сервера Express.

## <a name="authors"></a>Авторы

- [Рубен Верборг](https://ruben.verborgh.org/)
- [Оливье Лалонд](mailto:olalonde@gmail.com)
- [Джеймс Талмадж](mailto:james@talmage.io)

## <a name="license"></a>Лицензия

[Лицензия MIT](https://github.com/follow-redirects/follow-redirects/blob/master/LICENSE)
