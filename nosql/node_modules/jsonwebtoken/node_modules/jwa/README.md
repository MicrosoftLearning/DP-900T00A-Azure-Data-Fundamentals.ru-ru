---
ms.openlocfilehash: 6aae1c88465791540ed5192f26e8f48b83eb2b47
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052428"
---
# <a name="node-jwa-build-statushttpstravis-ciorgbrianloveswordsnode-jwa"></a>node-jwa [![Статус сборки](https://travis-ci.org/brianloveswords/node-jwa.svg?branch=master)](https://travis-ci.org/brianloveswords/node-jwa)

Реализация [веб-алгоритмов JSON](http://tools.ietf.org/id/draft-ietf-jose-json-web-algorithms-08.html). Только на данном этапе включает в основном алгоритмы, необходимые для [веб-подписей JSON](http://self-issued.info/docs/draft-ietf-jose-json-web-signature.html).

Эта библиотека поддерживает все необходимые, рекомендуемые и необязательные алгоритмы шифрования для JWS:

Значение параметра | Алгоритм цифровой подписи или MAC
----------------|----------------------------
HS256 | HMAC с использованием хэш-алгоритма SHA-256
HS384 | HMAC с использованием хэш-алгоритма SHA-384
HS512 | HMAC с использованием хэш-алгоритма SHA-512
RS256 | RSASSA с использованием хэш-алгоритма SHA-256
RS384 | RSASSA с использованием хэш-алгоритма SHA-384
RS512 | RSASSA с использованием хэш-алгоритма SHA-512
PS256 | RSASSA-PSS с использованием хэш-алгоритма SHA-256
PS384 | RSASSA-PSS с использованием хэш-алгоритма SHA-384
PS512 | RSASSA-PSS с использованием хэш-алгоритма SHA-512
ES256 | ECDSA с использованием кривой P-256 и хэш-алгоритма SHA-256
ES384 | ECDSA с использованием кривой P-384 и хэш-алгоритма SHA-384
ES512 | ECDSA с использованием кривой P-521 и хэш-алгоритма SHA-512
нет | Отсутствуют цифровые подписи или значения MAC

Обратите внимание, что PS* работает только в node.js 6.12 b более поздних версий (за исключением версии 7.x).

# <a name="requirements"></a>Требования

Для выполнения тестов требуется последняя версия OpenSSL. **Версия, которая поставляется с OS X (OpenSSL 0.9.8r от 8 февраля
2011) недостаточно новая**, так как не полностью поддерживает ключи ECDSA. Необходимо использовать версию старше 1.0.0. Мы тестировали работу библиотеки с OpenSSL 1.0.1c от 10 мая 2012 года.

# <a name="testing"></a>Тестирование

Чтобы запустить тесты, выполните команду

```bash
$ npm test
```

Будет создан массив пар ключей для тестирования. Чтобы создать новые пары ключей, выполните `make clean` перед повторным запуском `npm test`.

## <a name="methodology"></a>Методика

Я порождаю `openssl dgst -sign` для проверки подписи OpenSSL → проверяю JS verify и выполняю `openssl dgst -verify` для проверки подписи JS → проверяю OpenSSL для каждого алгоритма RSA и ECDSA.

# <a name="usage"></a>Использование

## <a name="jwaalgorithm"></a>jwa(algorithm)

Создает новый объект `jwa` с методами `sign` и `verify` для алгоритма. Допустимые значения для алгоритма можно найти в приведенной выше таблице (`'HS256'`, `'HS384'` и т. д.), в них не учитывается регистр. При передаче недопустимого значения для алгоритма возникает ошибка `TypeError`.


## <a name="jwasigninput-secretorprivatekey"></a>jwa#sign(input, secretOrPrivateKey)

Подписывает входные данные с помощью секрета для алгоритмов HMAC или закрытого ключа для алгоритмов RSA и ECDSA.

Если входные данные еще не являются строкой или буфером, для них вызывается средство `JSON.stringify` для принудительного преобразования.

Для алгоритма HMAC значение `secretOrPrivateKey` должно быть строкой или буфером. Для ECDSA и RSA значение должно быть строкой, которая представляет **закрытый** ключ в кодировке PEM.

Выходные данные имеют формат [base64url](http://en.wikipedia.org/wiki/Base64#URL_applications). Это сделано для удобства, так как JWS ожидает подпись в этом формате. Если приложению требуются выходные данные в другом формате, [откройте проблему](https://github.com/brianloveswords/node-jwa/issues). Вы можете использовать [brianloveswords/base64url](https://github.com/brianloveswords/base64url) для декодирования подписи.

В node.js *версии 0.11.8* была введена поддержка SPKAC. Если версия node.js позволяет, можно передать объект `{ key: '..', passphrase: '...' }`


## <a name="jwaverifyinput-signature-secretorpublickey"></a>jwa#verify(input, signature, secretOrPublicKey)

Проверяет подпись. Возвращает значение `true` или `false`.

Значение `signature` должно быть строкой в кодировке base64url.

Для алгоритма HMAC значение `secretOrPublicKey` должно быть строкой или буфером. Для ECDSA и RSA значение должно быть строкой, которая представляет **открытый** ключ в кодировке PEM.


# <a name="example"></a>Пример

Код проверки подлинности сообщений с помощью хэш-функций
```js
const jwa = require('jwa');

const hmac = jwa('HS256');
const input = 'super important stuff';
const secret = 'shhhhhh';

const signature = hmac.sign(input, secret);
hmac.verify(input, signature, secret) // === true
hmac.verify(input, signature, 'trickery!') // === false
```

С ключами
```js
const fs = require('fs');
const jwa = require('jwa');
const privateKey = fs.readFileSync(__dirname + '/ecdsa-p521-private.pem');
const publicKey = fs.readFileSync(__dirname + '/ecdsa-p521-public.pem');

const ecdsa = jwa('ES512');
const input = 'very important stuff';

const signature = ecdsa.sign(input, privateKey);
ecdsa.verify(input, signature, publicKey) // === true
```
## <a name="license"></a>Лицензия

MIT

```
Copyright (c) 2013 Brian J. Brennan

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
```
