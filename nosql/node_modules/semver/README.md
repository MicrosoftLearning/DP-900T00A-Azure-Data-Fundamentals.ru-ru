---
ms.openlocfilehash: 496981207a34eb019688e8f2583ccc1abcbb5bce
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "138051975"
---
<a name="semver1----the-semantic-versioner-for-npm"></a>semver(1) -- Средство семантического версионирования для npm
===========================================

## <a name="install"></a>Установка

```bash
npm install --save semver
````

## <a name="usage"></a>Использование

В качестве модуля узла:

```js
const semver = require('semver')

semver.valid('1.2.3') // '1.2.3'
semver.valid('a.b.c') // null
semver.clean('  =v1.2.3   ') // '1.2.3'
semver.satisfies('1.2.3', '1.x || >=2.5.0 || 5.0.0 - 7.2.3') // true
semver.gt('1.2.3', '9.8.7') // false
semver.lt('1.2.3', '9.8.7') // true
semver.minVersion('>=1.0.0') // '1.0.0'
semver.valid(semver.coerce('v2')) // '2.0.0'
semver.valid(semver.coerce('42.6.7.9.3-alpha')) // '42.6.7'
```

В качестве служебной программы командной строки:

```
$ semver -h

A JavaScript implementation of the https://semver.org/ specification
Copyright Isaac Z. Schlueter

Usage: semver [options] <version> [<version> [...]]
Prints valid versions sorted by SemVer precedence

Options:
-r --range <range>
        Print versions that match the specified range.

-i --increment [<level>]
        Increment a version by the specified level.  Level can
        be one of: major, minor, patch, premajor, preminor,
        prepatch, or prerelease.  Default level is 'patch'.
        Only one version may be specified.

--preid <identifier>
        Identifier to be used to prefix premajor, preminor,
        prepatch or prerelease version increments.

-l --loose
        Interpret versions and ranges loosely

-p --include-prerelease
        Always include prerelease versions in range matching

-c --coerce
        Coerce a string into SemVer if possible
        (does not imply --loose)

Program exits successfully if any valid version satisfies
all supplied ranges, and prints all satisfying versions.

If no satisfying versions are found, then exits failure.

Versions are printed in ascending order, so supplying
multiple versions to the utility will just sort them.
```

## <a name="versions"></a>Версии

Описание "версии" приведено в спецификации `v2.0.0` в<https://semver.org/>.

Символ `"="` или `"v"` в начале удаляется и игнорируется.

## <a name="ranges"></a>Диапазоны

`version range` — это набор `comparators`, который определяет версии, соответствующие диапазону.

`comparator` состоит из `operator` и `version`.  Набор примитивов `operators`:

* `<` Меньше чем
* `<=` Меньше или равно
* `>` Больше чем
* `>=` Больше или равно
* `=` Равно.  Если оператор не указан, предполагается равенство, поэтому этот оператор является необязательным, но МОЖЕТ быть включен.

Например, блок сравнения `>=1.2.7` будет соответствовать версиям `1.2.7`, `1.2.8`, `2.5.3` и `1.3.9`, но не версиям `1.2.6` или `1.1.0`.

Блоки сравнения можно объединять с помощью пробелов, чтобы сформировать объект `comparator set`, которому удовлетворяет **пересечение** всех блоков сравнения, которые он включает.

Диапазон состоит из одного или нескольких наборов блоков сравнения, объединенных с использованием `||`.  Версия соответствует диапазону, только в том случае, если каждому блоку сравнения хотя бы в одном из наборов блоков сравнения с разделением `||` удовлетворяет версия.

Например, диапазон `>=1.2.7 <1.3.0` будет соответствовать версиям `1.2.7`, `1.2.8` и `1.2.99`, но не версиям `1.2.6`, `1.3.0` или `1.1.0`.

Диапазон `1.2.7 || >=1.2.9 <2.0.0` будет соответствовать версиям `1.2.7`, `1.2.9` и `1.4.6`, но не версиям `1.2.8` или `2.0.0`.

### <a name="prerelease-tags"></a>Теги предварительного выпуска

Если у версии есть тег предварительной версии (например, `1.2.3-alpha.3`), то она будет разрешена только для соответствия наборам блоков сравнения, если по крайней мере один блок сравнения с тем же кортежем `[major, minor, patch]` также содержит тег предварительной версии.

Например, диапазон `>1.2.3-alpha.3` может иметь разрешение для соответствия версии `1.2.3-alpha.7`, но ему *не* будет удовлетворять `3.4.5-alpha.9`, хотя `3.4.5-alpha.9` технически "больше чем" `1.2.3-alpha.3` согласно правилам сортировки SemVer.  Диапазон версий принимает только теги предварительной версии в `1.2.3` версии.  Версия `3.4.5` *удовлетворяет* диапазону, так как не содержит флаг предварительной версии и имеет значение `3.4.5` больше чем `1.2.3-alpha.7`.

Такое поведение решает две задачи.  Во-первых, предварительные версии часто обновляются очень быстро и содержат много критических изменений, которые (по задумке автора) еще не годятся для общего пользования.
Поэтому по умолчанию они исключаются из семантики сопоставления диапазонов.

Во-вторых, пользователь, который решил использовать предварительную версию, четко обозначил свое намерение использовать *этот конкретный* набор альфа-, бета-версий и версий rc.  Включив в диапазон тег предварительной версии, пользователь тем самым указывает, что он знает о риске.  Тем не менее, все-таки неуместно предполагать, что пользователи вместе с тем согласились принять сходный риск в отношении *следующего* набора предварительных версий.

Обратите внимание, что такое поведение можно подавить (рассматривая все предварительные версии, как если бы они были обычными версиями, при сопоставлении диапазонов), задав флаг `includePrerelease` в объекте параметров для любых [функций](https://github.com/npm/node-semver#functions), которые выполняют сопоставление диапазона.

#### <a name="prerelease-identifiers"></a>Идентификаторы предварительных выпусков

Метод `.inc` принимает дополнительный строковый аргумент `identifier`, который добавляет значение строки как идентификатор предварительной версии:

```javascript
semver.inc('1.2.3', 'prerelease', 'beta')
// '1.2.4-beta.0'
```

Пример командной строки:

```bash
$ semver 1.2.3 -i prerelease --preid beta
1.2.4-beta.0
```

Затем его можно использовать для дальнейшего приращения:

```bash
$ semver 1.2.4-beta.0 -i prerelease
1.2.4-beta.1
```

### <a name="advanced-range-syntax"></a>Расширенный синтаксис диапазона

Расширенный синтаксис диапазона детерминированно удаляет синтаксический сахар для примитивных блоков сравнения.

Расширенные диапазоны могут объединяться так же, как и примитивные блоки сравнения, с использованием пробелов или `||`.

#### <a name="hyphen-ranges-xyz---abc"></a>Диапазоны дефисов `X.Y.Z - A.B.C`

Указывает инклюзивный набор.

* `1.2.3 - 2.3.4` := `>=1.2.3 <=2.3.4`

Если частичная версия указана в качестве первой версии в инклюзивном диапазоне, отсутствующие части заменяются нулями.

* `1.2 - 2.3.4` := `>=1.2.0 <=2.3.4`

Если частичная версия указана в качестве второй версии в инклюзивном диапазоне, принимаются все версии, начинающиеся с предоставленных частей кортежа, однако не принимаются никакие версии со значениями больше предоставленных частей кортежа.

* `1.2.3 - 2.3` := `>=1.2.3 <2.4.0`
* `1.2.3 - 2` := `>=1.2.3 <3.0.0`

#### <a name="x-ranges-12x-1x-12-"></a>X-диапазоны `1.2.x` `1.X` `1.2.*` `*`

Любой из `X`, `x` или `*` можно использовать для "подмены" одного из числовых значений в кортеже `[major, minor, patch]`.

* `*` := `>=0.0.0` (соответствует любая версия)
* `1.x` := `>=1.0.0 <2.0.0` (соответствующая основная версия)
* `1.2.x` := `>=1.2.0 <1.3.0` (соответствующие основные и дополнительные версии)

Диапазон частичных версий рассматривается как X-диапазон, поэтому специальный символ фактически не является обязательным.

* `""` (пустая строка) := `*` := `>=0.0.0`
* `1` := `1.x.x` := `>=1.0.0 <2.0.0`
* `1.2` := `1.2.x` := `>=1.2.0 <1.3.0`

#### <a name="tilde-ranges-123-12-1"></a>Диапазоны тильды `~1.2.3` `~1.2` `~1`

Разрешает изменения на уровне исправлений, если в блоке сравнения указана дополнительная версия.  Разрешает незначительные изменения, если нет.

* `~1.2.3` := `>=1.2.3 <1.(2+1).0` := `>=1.2.3 <1.3.0`
* `~1.2` := `>=1.2.0 <1.(2+1).0` := `>=1.2.0 <1.3.0` (эквивалентно `1.2.x`)
* `~1` := `>=1.0.0 <(1+1).0.0` := `>=1.0.0 <2.0.0` (эквивалентно `1.x`)
* `~0.2.3` := `>=0.2.3 <0.(2+1).0` := `>=0.2.3 <0.3.0`
* `~0.2` := `>=0.2.0 <0.(2+1).0` := `>=0.2.0 <0.3.0` (эквивалентно `0.2.x`)
* `~0` := `>=0.0.0 <(0+1).0.0` := `>=0.0.0 <1.0.0` (эквивалентно `0.x`)
* `~1.2.3-beta.2` := `>=1.2.3-beta.2 <1.3.0` Обратите внимание, что предварительные выпуски в версии `1.2.3` будут разрешены, если они больше или равны `beta.2`.  Таким образом, `1.2.3-beta.4` разрешено, но `1.2.4-beta.2` не разрешено, потому что это предварительный выпуск другого кортежа `[major, minor, patch]`.

#### <a name="caret-ranges-123-025-004"></a>Диапазоны курсоров `^1.2.3` `^0.2.5` `^0.0.4`

Разрешает изменения, не изменяющие крайнее левое ненулевое число в кортеже `[major, minor, patch]`.  Иными словами, это позволяет устанавливать исправления и дополнительные обновления для версий `1.0.0` и более поздних версий, обновления исправлений для версий `0.X >=0.1.0`, а также *отсутствие* обновлений для версий `0.0.X`.

Многие авторы рассматривают версию `0.x`, как если бы `x` был основным индикатором критического изменения.

Диапазоны курсоров идеально подходят, если автор вносит критические изменения в выпуск `0.3.0` по сравнению с `0.2.4`, что является распространенной практикой.
Однако предполагается, что критических изменений в версии `0.2.5` по сравнению с `0.2.4` *не* предполагается.  Это позволяет вносить изменения, которые предположительно являются аддитивными (но не критическими), как это часто бывает.

* `^1.2.3` := `>=1.2.3 <2.0.0`
* `^0.2.3` := `>=0.2.3 <0.3.0`
* `^0.0.3` := `>=0.0.3 <0.0.4`
* `^1.2.3-beta.2` := `>=1.2.3-beta.2 <2.0.0` Обратите внимание, что предварительные выпуски в версии `1.2.3` будут разрешены, если они больше или равны `beta.2`.  Таким образом, `1.2.3-beta.4` разрешено, но `1.2.4-beta.2` не разрешено, потому что это предварительный выпуск другого кортежа `[major, minor, patch]`.
* `^0.0.3-beta` := `>=0.0.3-beta <0.0.4` Обратите внимание, что предварительные выпуски *только* в версии `0.0.3` будут разрешены, если они больше или равны `beta`.  Таким образом, `0.0.3-pr.2` будет разрешен.

При синтаксическом анализе диапазонов курсора отсутствующее значение `patch` удаляет синтаксический сахар в нескольких `0`, но позволит гибко использовать это значение, даже если основные и дополнительные версии обе являются `0`.

* `^1.2.x` := `>=1.2.0 <2.0.0`
* `^0.0.x` := `>=0.0.0 <0.1.0`
* `^0.0` := `>=0.0.0 <0.1.0`

Отсутствующие значения `minor` и `patch` значения удалят синтаксический сахар до нуля, но также обеспечивают гибкость использования этих значений, даже если основная версия является нулевой.

* `^1.x` := `>=1.0.0 <2.0.0`
* `^0.x` := `>=0.0.0 <1.0.0`

### <a name="range-grammar"></a>Грамматика диапазона

Иными словами, есть грамматика Backus-Naur для диапазонов, которая дает ряд преимуществ для авторов синтаксического анализа:

```bnf
range-set  ::= range ( logical-or range ) *
logical-or ::= ( ' ' ) * '||' ( ' ' ) *
range      ::= hyphen | simple ( ' ' simple ) * | ''
hyphen     ::= partial ' - ' partial
simple     ::= primitive | partial | tilde | caret
primitive  ::= ( '<' | '>' | '>=' | '<=' | '=' ) partial
partial    ::= xr ( '.' xr ( '.' xr qualifier ? )? )?
xr         ::= 'x' | 'X' | '*' | nr
nr         ::= '0' | ['1'-'9'] ( ['0'-'9'] ) *
tilde      ::= '~' partial
caret      ::= '^' partial
qualifier  ::= ( '-' pre )? ( '+' build )?
pre        ::= parts
build      ::= parts
parts      ::= part ( '.' part ) *
part       ::= nr | [-0-9A-Za-z]+
```

## <a name="functions"></a>Функции

Все методы и классы принимают окончательный аргумент объекта `options`.  Все параметры в этом объекте имеют значение `false` по умолчанию.  Поддерживаются следующие параметры:

- `loose`  Будьте более снисходительны к не совсем допустимым строкам semver.
  (Все выходные данные, полученные в результате, всегда будут на 100% соответствовать, конечно.)  По соображениям обратной совместимости, если аргумент `options` является логическим значением, а не объектом, он интерпретируется как параметр `loose`.
- `includePrerelease`  Настройте для подавления [поведения по умолчанию](https://github.com/npm/node-semver#prerelease-tags), которое предполагает исключение предварительных версий с тегами из диапазонов, если они явно не включены.

Блоки сравнения в строгом режиме и диапазоны будут строгими в отношении строк SemVer, для которых они выполняют синтаксический анализ.

* `valid(v)`. Возвращает проанализированную версию или значение NULL, если версия не являются допустимой.
* `inc(v, release)`. Возвращается версия с приращением по типу выпуска (`major`,   `premajor`, `minor`, `preminor`, `patch`, `prepatch` или `prerelease`), или имеет значение NULL, если не является допустимой
  * `premajor` в одном вызове увеличивает номер версии до следующей основной версии и до предварительной версии этой основной версии.
    `preminor` и `prepatch` работают так же.
  * При вызове из версии, отличной от предварительной версии, `prerelease` будет работать так же, как `prepatch`. Это повышает версию исправления, а затем создает предварительную версию. Если входная версия уже является предварительной версией, она будет повышена.
* `prerelease(v)`. Возвращает массив компонентов предварительной версии или значение NULL, если он не существует. Например, `prerelease('1.2.3-alpha.1') -> ['alpha', 1]`.
* `major(v)`. Возвращается номер основной версии.
* `minor(v)`. Возвращается номер дополнительной версии.
* `patch(v)`. Возвращается номер версии исправления.
* `intersects(r1, r2, loose)`. Возвращается значение true, если два указанных диапазона или блока сравнения пересекаются.
* `parse(v)`. Попытка синтаксического анализа строки как семантической версии, в результате которой возвращается объект `SemVer` или `null`.

### <a name="comparison"></a>Сравнение

* `gt(v1, v2)`: `v1 > v2`
* `gte(v1, v2)`: `v1 >= v2`
* `lt(v1, v2)`: `v1 < v2`
* `lte(v1, v2)`: `v1 <= v2`
* `eq(v1, v2)`. `v1 == v2` Это верно, если они логически эквивалентны, даже если они не совпадают.  Вы уже знаете, как сравнивать строки.
* `neq(v1, v2)`. `v1 != v2` Противоположность `eq`.
* `cmp(v1, comparator, v2)`. Передайте строку сравнения, и она вызовет соответствующую функцию выше.  `"==="` и `"!=="` выполняют простое сравнение строк, но включены для полноты.  Создает исключение, если указана недопустимая строка сравнения.
* `compare(v1, v2)`. Возвращается `0`, если `v1 == v2` или `1` если `v1` больше, или `-1` если `v2` больше.  Сортировка в порядке возрастания при передаче в `Array.sort()`.
* `rcompare(v1, v2)`. Действие, обратное сравнению.  Сортировка массива версий в порядке убывания при передаче в `Array.sort()`.
* `diff(v1, v2)`. Возвращает разницу между двумя версиями по типу выпуска (`major`, `premajor`, `minor`, `preminor`, `patch`, `prepatch` или `prerelease`) или null, если версии одинаковы.

### <a name="comparators"></a>Блоки сравнения

* `intersects(comparator)`. Возвращается значение true, если блоки сравнения пересекаются

### <a name="ranges"></a>Диапазоны

* `validRange(range)`. Возвращается допустимый диапазон или значение NULL, если он не является допустимым
* `satisfies(version, range)`. Возвращается значение true, если версия удовлетворяет диапазону.
* `maxSatisfying(versions, range)`. Возвращается самая высокая версия в списке, удовлетворяющая диапазону, или `null`, если ни одна из них не удовлетворяет.
* `minSatisfying(versions, range)`. Возвращается самая высокая версия в списке, удовлетворяющая диапазону, или `null`, если ни одна из них не удовлетворяет.
* `minVersion(range)`. Возвращается наименьшая версия, которая теоретически может соответствовать заданному диапазону.
* `gtr(version, range)`. Возвращается значение `true`, если версия больше всех версий, возможных в диапазоне.
* `ltr(version, range)`. Возвращается значение `true`, если версия меньше всех версий, возможных в диапазоне.
* `outside(version, range, hilo)`. Возвращается значение true, если версия находится за пределами диапазона в направлении повышения или понижения.  Аргумент `hilo` должен быть строкой `'>'` или `'<'`.  (Это функция, вызываемая `gtr` и `ltr`.)
* `intersects(range)`. Возвращается значение true, если какой-либо из блоков сравнения диапазонов пересекается

Обратите внимание: поскольку диапазоны могут быть несмежными, версия не может быть больше диапазона, меньше диапазона, *или* удовлетворять диапазону.  Например, диапазон `1.2 <1.2.9 || >2.0.0` будет иметь заглушку из `1.2.9` вплоть до `2.0.0`, так что версия `1.2.10` не будет больше диапазона (так как `2.0.1` ему соответствует, то есть имеет более высокое значение), или меньше диапазона (так как `1.2.8` ему соответствует, то есть, имеет более низкое значение); она также не удовлетворяет диапазону.

Если вы хотите узнать, удовлетворяет ли версия диапазону, используйте функцию `satisfies(version, range)`.

### <a name="coercion"></a>Приведение

* `coerce(version)`. По возможности приводит строку к SemVer

Это призвано обеспечить довольно свободный перевод строки, отличной от semver, в semver. Выполняется поиск первого символа в строке и использует все оставшиеся символы, удовлетворяющие по меньшей мере частичной строке semver (например, `1`, `1.2`, `1.2.3`), до максимально допустимой длины (256 символов).  Более длинные версии просто усекаются (`4.6.3.9.2-alpha2` становится `4.6.3`).  Весь окружающий текст просто игнорируется (`v3.4 replaces v3.3.1` становится `3.4.0`).  Только текст, в котором отсутствуют символы, приведет к сбою приведения (`version one` является недопустимым).  Максимальная длина любого компонента semver, который рассматривается для приведения, составляет 16 символов; более длинные компоненты будут игнорироваться (`10000000000000000.4.7.4` становится `4.7.4`).  Максимальное значение для любого компонента semver — `Number.MAX_SAFE_INTEGER || (2**53 - 1)`; более ценные компоненты недопустимы (`9999999999999999.4.7.4` скорее всего, недопустимы).
