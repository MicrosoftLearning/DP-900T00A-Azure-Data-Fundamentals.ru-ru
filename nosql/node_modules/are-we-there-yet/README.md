---
ms.openlocfilehash: 34b661fbb1237d51bdab932626d19518225841a0
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052911"
---
<a name="are-we-there-yet"></a>are-we-there-yet
----------------

Отслеживайте сложные иерархии состояний выполнения асинхронных задач.  Это позволяет записывать ход выполнения большого рекурсивного развертывания и сообщать о нем, а также собирать рабочие процессы типов, настолько типичные для асинхронных задач.

Что делать с данными о выполнении — решать вам, однако наиболее распространенным вариантом использования является их передача в один из множества модулей индикатора выполнения.

Большинство модулей индикатора выполнения включают элементарную версию этого, однако мои потребности были сложнее.

<a name="usage"></a>Использование
=====

```javascript
var TrackerGroup = require("are-we-there-yet").TrackerGroup

var top = new TrackerGroup("program")

var single = top.newItem("one thing", 100)
single.completeWork(20)

console.log(top.completed()) // 0.2

fs.stat("file", function(er, stat) {
  if (er) throw er  
  var stream = top.newStream("file", stat.size)
  console.log(top.completed()) // now 0.1 as single is 50% of the job and is 20% complete
                              // and 50% * 20% == 10%
  fs.createReadStream("file").pipe(stream).on("data", function (chunk) {
    // do stuff with chunk
  })
  top.on("change", function (name) {
    // called each time a chunk is read from "file"
    // top.completed() will start at 0.1 and fill up to 0.6 as the file is read
  })
})
```

<a name="shared-methods"></a>Общие методы
==============

* var completed = tracker.completed()

Область реализации: `Tracker`, `TrackerGroup`, `TrackerStream`

Возвращает соотношение между выполненной работой и работой, которую предстоит выполнить. Диапазон от 0 до 1.

* tracker.finish()

Область реализации: `Tracker`, `TrackerGroup`

Помечает модуль отслеживания как завершенный. С помощью TrackerGroup это помечает все его компоненты как завершенные.

Помечает все компоненты этого средства отслеживания как завершенные, что, в свою очередь, означает, что теперь `tracker.completed()` будет иметь для него значение 1.

Это приведет к выдаче одного или нескольких событий `change`.

<a name="events"></a>События
======

Все объекты средства отслеживания выдают события `change` со следующими аргументами:

```
function (name, completed, tracker)
```

`name` — имя средства отслеживания, которое изначально выдало событие, а если у него его не было — первая содержащая группа средств отслеживания, у которой оно было.

`completed` — процент выполнения (как возвращает метод `tracker.completed()`).

`tracker` — объект средства отслеживания, в котором вы прослушиваете события.

<a name="trackergroup"></a>TrackerGroup
============

* var tracker = new TrackerGroup(**name**)

  * **name** *(необязательно)*  — имя этой группы отслеживания, используемое в уведомлениях об изменениях, если обновление компонента не имеет имени. Значение по умолчанию не определено.

Создает новую пустую группу агрегирования средств отслеживания. Это средства отслеживания, состояние выполнения которых определяется состоянием выполнения других средств отслеживания.

* tracker.addUnit(**otherTracker**, **weight**)

  * **otherTracker** — любой из других объектов средства отслеживания are-we-there-yet.
  * **weight** *(необязательно)*  — вес для передачи средству отслеживания, по умолчанию — 1.

Добавляет **otherTracker** в эту группу агрегирования. Вес определяет, сколько времени это средство отслеживания будет выполняться относительно других единиц.  Например, добавляя средство отслеживания с весом 1 и еще одно с весом 2, вы говорите, что второе будет выполняться в два раза дольше первого.  Таким образом, первое будет отвечать за 33 % выполнения этого средства отслеживания, а второе — за оставшиеся 67 %.

Возвращает **otherTracker**.

* var subGroup = tracker.newGroup(**name**, **weight**)

Приведенное выше в точности эквивалентно следующему:

```javascript
  var subGroup = tracker.addUnit(new TrackerGroup(name), weight)
```

* var subItem = tracker.newItem(**name**, **todo**, **weight**)

Приведенное выше в точности эквивалентно следующему:

```javascript
  var subItem = tracker.addUnit(new Tracker(name, todo), weight)
```

* var subStream = tracker.newStream(**name**, **todo**, **weight**)

Приведенное выше в точности эквивалентно следующему:

```javascript
  var subStream = tracker.addUnit(new TrackerStream(name, todo), weight)
```

* console.log( tracker.debug() )

Возвращает дерево, показывающее выполнение этой группы средств отслеживания и всех ее дочерних элементов, включая рекурсивный ввод всех дочерних элементов.

<a name="tracker"></a>Tracker
=======

* var tracker = new Tracker(**name**, **todo**)

  * **name** *(необязательно)* Имя этого счетчика для отчета в событиях изменения.  Значение по умолчанию не определено.
  * **todo** *(необязательно)* Объем работ (число). Значение по умолчанию — 0.

Обычно они создаются как часть группы средств отслеживания (через `newItem`).

* var completed = tracker.completed()

Возвращает соотношение между выполненной работой и работой, которую предстоит выполнить. Диапазон от 0 до 1. Если общий объем работ равен 0, возвращается значение 0.

* tracker.addWork(**todo**)

  * **todo** Число, добавляемое к объему работы, которую предстоит выполнить.

Увеличивает объем работы, которую предстоит выполнить, уменьшая тем самым процент выполнения.  Активирует событие `change`.

* tracker.completeWork(**completed**)

  * **completed** Число для добавления к выполненной работе.

Увеличивает объем выполненной работы, увеличивая тем самым процент выполнения.
Никогда не будет увеличивать выполненную работу до величины, превышающей объем работы, которую предстоит выполнить. То есть проценты > 100 % не допускаются. Активирует событие `change`.

* tracker.finish()

Помечает это средство отслеживания как выполненное; tracker.completed() теперь будет иметь значение 1. Активирует событие `change`.

<a name="trackerstream"></a>TrackerStream
=============

* var tracker = new TrackerStream(**name**, **size**, **options**)

  * **name** *(необязательно)* Имя этого счетчика для отчета в событиях изменения.  Значение по умолчанию не определено.
  * **size** *(необязательно)* Количество байтов, отправляемых через этот поток.
  * **options** *(необязательно)* Хэш параметров потока

Объект потока средства отслеживания — это сквозной поток, который обновляет внутренний объект средства отслеживания каждый раз, когда проходит блок.  Он предназначен для отслеживания загрузок, извлечения файлов и других связанных действий. Чтобы его использовать, вы подводите к нему источник данных, а затем используете его в качестве источника данных.

Если у ваших данных имеется атрибут length, то он используется в качестве объема работы, выполненной при передаче блока.  Если это не так (например, потоки объектов), каждый блок засчитывается за выполнение 1 единицы работы, поэтому размер должен представлять собой общее количество объектов, передаваемых в поток.

* tracker.addWork(**todo**)

  * **todo** Увеличивает ожидаемый общий размер на **todo** Б.

Увеличивает объем работы, которую предстоит выполнить, уменьшая тем самым процент выполнения.  Активирует событие `change`.
