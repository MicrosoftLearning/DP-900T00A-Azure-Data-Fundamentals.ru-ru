---
ms.openlocfilehash: 50690c00791b1f6ca1d585c1fb653f0ec4794578
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052660"
---
# <a name="prebuild-install"></a>prebuild-install

> **Для облегчения установки предварительно созданных двоичных файлов для нескольких версий Node.js и Electron на определенной платформе используется интерфейс командной строки.**
> По умолчанию с командной строки загружаются предварительно созданные двоичные файлы из выпуска GitHub.

[![npm](https://img.shields.io/npm/v/prebuild-install.svg)](https://www.npmjs.com/package/prebuild-install)
![Node version](https://img.shields.io/node/v/prebuild-install.svg)
[![Test](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml/badge.svg)](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml)
[![david](https://david-dm.org/prebuild/prebuild-install.svg)](https://david-dm.org/prebuild/prebuild-install)
[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com/)

## <a name="note"></a>Примечание

**Вместо связывания [`prebuild`](https://github.com/prebuild/prebuild) с [`prebuild-install`](https://github.com/prebuild/prebuild-install), рекомендуется связать [`prebuildify`](https://github.com/prebuild/prebuildify) с [`node-gyp-build`](https://github.com/prebuild/node-gyp-build).**

Вместе с `prebuildify` все предварительно созданные двоичные файлы поставляются внутри пакета, опубликованного в npm. Поэтому отдельный шаг загрузки, подобно `prebuild`, не требуется. Парадокс этого подхода заключается в том, что скачивание всех предварительно созданных двоичных файлов для каждой платформы выполняется быстрее, чем скачивание одного предварительно созданного двоичного файла с помощью установочного сценария.

Плюсы:

1. Отсутствует дополнительный шаг скачивания, что повышает надежность и скорость установки.
2. Поддерживается локальное изменение версий среды выполнения и использование одной и той же установки между Node.js и Electron. Повторная установка или построение не требуется, так как все предварительно созданные двоичные файлы находятся в npm tarball, и правильный из них просто выбирается во время выполнения.
3. Зависимость среды выполнения `node-gyp-build` ни от чего не зависит и не имеет принципа, так как внедрение зависимостей приведет к сокращению времени установки.
4. Предварительно созданные двоичные файлы работают даже в том случае, если сценарии установки npm отключены.
5. Контрольная сумма пакетов npm также используется для предварительно созданных двоичных файлов.

Недостатки:

1. Установленный пакет npm занимает большее место на диске. Использование [Node-API](https://nodejs.org/api/n-api.html) устраняет эту проблему, так как двоичные файлы Node-API не зависят от среды выполнения и совместимы с пересылкой.
2. Публикация является более сложным процессом, так как команда `npm publish` должна выполняться после компиляции и получения предварительно созданных двоичных файлов (как правило, в CI).

## <a name="usage"></a>Использование

Для создания и отправки предварительно созданных двоичных файлов используйте [`prebuild`](https://github.com/prebuild/prebuild). Затем измените сценарий установки package.json на следующий:

```json
{
  "scripts": {
    "install": "prebuild-install || node-gyp rebuild"
  }
}
```

### <a name="help"></a>Справка

```
prebuild-install [options]

  --download    -d  [url]       (download prebuilds, no url means github)
  --target      -t  version     (version to install for)
  --runtime     -r  runtime     (Node runtime [node, napi or electron] to build or install for, default is node)
  --path        -p  path        (make a prebuild-install here)
  --token       -T  gh-token    (github token for private repos)
  --arch            arch        (target CPU architecture, see Node OS module docs, default is current arch)
  --platform        platform    (target platform, see Node OS module docs, default is current platform)
  --tag-prefix <prefix>         (github tag prefix, default is "v")
  --build-from-source           (skip prebuild download)
  --verbose                     (log verbosely)
  --libc                        (use provided libc rather than system default)
  --debug                       (set Debug or Release configuration)
  --version                     (print prebuild-install version and exit)
```

При выполнении `prebuild-install` с помощью сценария `npm` параметры `--build-from-source`, `--debug`, `--download`, `--target`, `--runtime`, `--arch` и`--platform` могут передаваться в качестве аргументов для команды `npm`.

Кроме того, можно установить переменные среды `npm_config_build_from_source=true`, `npm_config_platform`, `npm_config_arch`, `npm_config_target` и `npm_config_runtime`:

### <a name="private-repositories"></a>Частные репозитории

`prebuild-install` поддерживает скачивание предварительно собранных файлов из частных репозиториев GitHub с помощью `-T <github-token>`:

```
$ prebuild-install -T <github-token>
```

Если использовать маркер в CLI не требуется, его можно поместить в `~/.prebuild-installrc`:

```
token=<github-token>
```

Кроме того, его можно указать в переменной среды `prebuild-install_token`.

Обратите внимание, что при использовании маркера GitHub применяется интерфейс API для разрешения правильного выпуска, это означает, что у вас присутствует [ограничение скорости GitHub](https://developer.github.com/v3/rate_limit/).

### <a name="create-github-token"></a>Создание маркера GitHub

Для создания маркера необходимо:

- Перейти на [эту страницу](https://github.com/settings/tokens)
- Нажмите кнопку `Generate new token`
- Присвойте маркеру имя и нажмите кнопку `Generate token` ниже

![prebuild-token](https://cloud.githubusercontent.com/assets/13285808/20844584/d0b85268-b8c0-11e6-8b08-2b19522165a9.png)

Области по умолчанию можно оставить.

### <a name="custom-binaries"></a>Пользовательские двоичные файлы

Конечный пользователь может переопределить расположение загружаемых двоичных файлов с помощью переменных среды в файле .npmrc.
Переменная должна соответствовать маске `% your package name %_binary_host` или `% your package name %_binary_host_mirror`. Пример:

```
leveldown_binary_host=http://overriden-host.com/overriden-path
```

Обратите внимание, что вложенный путь версии пакета и имя файла также будут добавлены.
Поэтому при установке `leveldown@1.2.3` результирующий URL-адрес будет следующим:

```
http://overriden-host.com/overriden-path/v1.2.3/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

#### <a name="local-prebuilds"></a>Локальные предварительно собранные файлы

Если вы хотите использовать предварительно собранные файлы из локальной файловой системы, можно использовать переменную `% your package name %_local_prebuilds` .npmrc, чтобы задать путь к папке к предварительно собранным файлам. Пример:

```
leveldown_local_prebuilds=/path/to/prebuilds
```

Этот параметр будет виден непосредственно в этой папке для пакетов, созданных с помощью `prebuild`, например:

```
/path/to/prebuilds/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

Не абсолютные пути разрешаются относительно каталога пакета, вызывающего установку предварительной сборки, например для вложенных зависимостей.

### <a name="cache"></a>Кэш

Все предварительно собранные двоичные файлы кэшируются для снижения объема трафика до минимума. Поэтому в процессе работы команды `prebuild-install` двоичные файлы сначала выбираются из кэша. Если двоичный файл не найден, будет выполнено его скачивание. В зависимости от среды папка кэша определяется в следующем порядке:

- `${npm_config_cache}/_prebuilds`
- `${APP_DATA}/npm-cache/_prebuilds`
- `${HOME}/.npm/_prebuilds`

## <a name="license"></a>Лицензия

MIT
